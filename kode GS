function doPost(e) {
  try {
    const ss = SpreadsheetApp.getActiveSpreadsheet();
    const sheetName = "DATA";
    const sh = ss.getSheetByName(sheetName) || ss.insertSheet(sheetName);

    // Header otomatis
    if (sh.getLastRow() === 0) {
      sh.appendRow([
        "Timestamp",
        "Region",
        "Nama COU",
        "Jenis Mesin",
        "Merk",
        "Type",
        "Serial Number",
        "Kondisi",
        "Lokasi",
        "Remote",
        "Kecukupan",
        "Saran / Usulan"
      ]);
    }

    const data = JSON.parse(e.postData.contents);

    const region = data.region || "";
    const namaCOU = data.nama_cou || "";
    const kecukupan = data.kecukupan || "";
    const saran = data.saran || "";

    data.mesin.forEach(m => {
      sh.appendRow([
        new Date(),
        region,
        namaCOU,
        m.jenis || "",
        m.merk || "",
        m.type || "",
        m.sn || "",
        m.kondisi || "",
        m.lokasi || "",
        m.remote || "",
        kecukupan,
        saran
      ]);
    });

    return ContentService.createTextOutput(
      JSON.stringify({ status: "success" })
    ).setMimeType(ContentService.MimeType.JSON);

  } catch (error) {
    return ContentService.createTextOutput(
      JSON.stringify({
        status: "error",
        message: error.toString()
      })
    ).setMimeType(ContentService.MimeType.JSON);
  }
}
